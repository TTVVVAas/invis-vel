<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GravaÃ§Ãµes - Centro de Monitoramento IA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .recordings-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .breadcrumb {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .breadcrumb a {
            color: #007bff;
            text-decoration: none;
            margin-right: 10px;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        .breadcrumb .separator {
            margin: 0 5px;
            color: #6c757d;
        }
        
        .recordings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .recording-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .recording-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .recording-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .recording-title {
            font-weight: bold;
            color: #333;
        }
        
        .recording-size {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .recording-info {
            margin-bottom: 15px;
        }
        
        .recording-date {
            color: #495057;
            font-size: 0.9em;
        }
        
        .recording-time {
            color: #6c757d;
            font-size: 0.85em;
        }
        
        .recording-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-download {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-download:hover {
            background: #218838;
        }
        
        .btn-play {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-play:hover {
            background: #138496;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .back-btn:hover {
            background: #5a6268;
        }
        
        .year-item, .month-item, .day-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .year-item:hover, .month-item:hover, .day-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .item-info h3 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .item-info p {
            margin: 0;
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .item-count {
            background: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="recordings-container">
        <header style="margin-bottom: 30px;">
            <h1>
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 10px;">
                    <rect x="2" y="2" width="20" height="16" rx="2" ry="2"></rect>
                    <circle cx="8" cy="10" r="2"></circle>
                    <path d="M16 10l2-2 2 2-2 2-2-2z"></path>
                </svg>
                GravaÃ§Ãµes
            </h1>
            <a href="{{ url_for('index') }}" class="back-btn">
                â† Voltar ao Monitoramento
            </a>
        </header>

        <div id="breadcrumb" class="breadcrumb"></div>
        <div id="content" class="loading">Carregando gravaÃ§Ãµes...</div>
    </div>

    <script>
        let currentPath = [];

        const isEmptyData = (value) => {
            if (Array.isArray(value)) {
                return value.length === 0;
            }
            if (value && typeof value === 'object') {
                return Object.keys(value).length === 0;
            }
            return !value;
        };

        const formatBytes = (bytes) => {
            if (typeof bytes !== 'number' || Number.isNaN(bytes)) {
                return 'â€”';
            }
            if (bytes === 0) {
                return '0 B';
            }
            const units = ['B', 'KB', 'MB', 'GB', 'TB'];
            let size = bytes;
            let unitIndex = 0;
            while (size >= 1024 && unitIndex < units.length - 1) {
                size /= 1024;
                unitIndex++;
            }
            return `${size.toFixed(1)} ${units[unitIndex]}`;
        };
        
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            let html = '<a href="#" onclick="loadRecordings(); return false;">ðŸ  GravaÃ§Ãµes</a>';
            
            currentPath.forEach((part, index) => {
                html += '<span class="separator">â†’</span>';
                if (index === currentPath.length - 1) {
                    html += `<strong>${part}</strong>`;
                } else {
                    const path = currentPath.slice(0, index + 1).join('/');
                    html += `<a href="#" onclick="navigateToPath('${path}'); return false;">${part}</a>`;
                }
            });
            
            breadcrumb.innerHTML = html;
        }
        
        function navigateToPath(path) {
            const parts = path.split('/');
            currentPath = parts;
            loadRecordings(parts);
        }
        
        function formatMonthName(month) {
            const months = {
                '01_Janeiro': 'Janeiro',
                '02_Fevereiro': 'Fevereiro',
                '03_MarÃ§o': 'MarÃ§o',
                '04_Abril': 'Abril',
                '05_Maio': 'Maio',
                '06_Junho': 'Junho',
                '07_Julho': 'Julho',
                '08_Agosto': 'Agosto',
                '09_Setembro': 'Setembro',
                '10_Outubro': 'Outubro',
                '11_Novembro': 'Novembro',
                '12_Dezembro': 'Dezembro'
            };
            return months[month] || month;
        }
        
        function loadRecordings(path = []) {
            currentPath = path;
            updateBreadcrumb();
            
            let url = '/api/recordings';
            if (path.length > 0) {
                const params = new URLSearchParams();
                if (path[0]) params.append('year', path[0]);
                if (path[1]) params.append('month', path[1]);
                if (path[2]) params.append('day', path[2]);
                url += '?' + params.toString();
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    displayContent(data, path);
                })
                .catch(error => {
                    console.error('Erro ao carregar gravaÃ§Ãµes:', error);
                    document.getElementById('content').innerHTML = '<div class="empty-state">Erro ao carregar gravaÃ§Ãµes</div>';
                });
        }
        
        function displayContent(data, path) {
            const content = document.getElementById('content');
            
            if (isEmptyData(data)) {
                content.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="16" rx="2" ry="2"></rect>
                            <circle cx="8" cy="10" r="2"></circle>
                            <path d="M16 10l2-2 2 2-2 2-2-2z"></path>
                        </svg>
                        <h3>Nenhuma gravaÃ§Ã£o encontrada</h3>
                        <p>As gravaÃ§Ãµes aparecerÃ£o aqui quando forem criadas</p>
                    </div>
                `;
                return;
            }
            
            if (path.length === 0) {
                // Mostrar anos
                displayYears(data);
            } else if (path.length === 1) {
                // Mostrar meses
                displayMonths(data);
            } else if (path.length === 2) {
                // Mostrar dias
                displayDays(data);
            } else if (path.length === 3) {
                // Mostrar vÃ­deos
                displayVideos(data);
            }
        }
        
        function displayYears(data) {
            const content = document.getElementById('content');
            let html = '<div>';
            
            for (const year in data) {
                const yearData = data[year];
                let totalVideos = 0;
                
                for (const month in yearData) {
                    for (const day in yearData[month]) {
                        totalVideos += yearData[month][day].length;
                    }
                }
                
                if (totalVideos > 0) {
                    html += `
                        <div class="year-item" onclick="navigateToPath('${year}')">
                            <div class="item-info">
                                <h3>ðŸ“… ${year}</h3>
                                <p>Clique para ver os meses</p>
                            </div>
                            <div class="item-count">${totalVideos} vÃ­deo${totalVideos > 1 ? 's' : ''}</div>
                        </div>
                    `;
                }
            }
            
            html += '</div>';
            content.innerHTML = html;
        }
        
        function displayMonths(data) {
            const content = document.getElementById('content');
            let html = '<div>';
            
            data.forEach(month => {
                html += `
                    <div class="month-item" onclick="navigateToPath('${month.year}/${month.month}')">
                        <div class="item-info">
                            <h3>ðŸ“† ${formatMonthName(month.month)}</h3>
                            <p>Clique para ver os dias</p>
                        </div>
                        <div class="item-count">${month.video_count} vÃ­deo${month.video_count > 1 ? 's' : ''}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }
        
        function displayDays(data) {
            const content = document.getElementById('content');
            let html = '<div>';
            
            data.forEach(day => {
                html += `
                    <div class="day-item" onclick="navigateToPath('${day.year}/${day.month}/${day.day}')">
                        <div class="item-info">
                            <h3>ðŸ“‹ Dia ${day.day}</h3>
                            <p>Clique para ver os vÃ­deos</p>
                        </div>
                        <div class="item-count">${day.video_count} vÃ­deo${day.video_count > 1 ? 's' : ''}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }
        
        function displayVideos(data) {
            const content = document.getElementById('content');
            
            if (!data || data.length === 0) {
                content.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="16" rx="2" ry="2"></rect>
                            <circle cx="8" cy="10" r="2"></circle>
                            <path d="M16 10l2-2 2 2-2 2-2-2z"></path>
                        </svg>
                        <h3>Nenhum vÃ­deo neste dia</h3>
                        <p>NÃ£o foram encontradas gravaÃ§Ãµes para este dia</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="recordings-grid">';
            
            data.forEach(video => {
                const videoPath = `${currentPath.join('/')}/${video.filename}`;
                const createdParts = (video.created || '').split(' ');
                const createdDate = createdParts[0] || '--';
                const createdTime = createdParts[1] || '--';
                const sizeText = video.size_formatted || formatBytes(video.size);
                
                html += `
                    <div class="recording-item">
                        <div class="recording-header">
                            <div class="recording-title">${video.filename}</div>
                            <div class="recording-size">${sizeText}</div>
                        </div>
                        <div class="recording-info">
                            <div class="recording-date">dY". ${createdDate}</div>
                            <div class="recording-time">dY? ${createdTime}</div>
                        </div>
                        <div class="recording-actions">
                            <a href="/api/recordings/download/${videoPath}" class="btn-download" download>
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Download
                            </a>
                            <a href="#" class="btn-play" onclick="playVideo('${videoPath}'); return false;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                </svg>
                                Reproduzir
                            </a>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }
        
        function playVideo(path) {
            // Implementar reproduÃ§Ã£o de vÃ­deo
            alert('FunÃ§Ã£o de reproduÃ§Ã£o serÃ¡ implementada em breve!\nVÃ­deo: ' + path);
        }
        
        // Carregar gravaÃ§Ãµes ao iniciar
        loadRecordings();
    </script>
</body>
</html>


